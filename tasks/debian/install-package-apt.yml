---
- name: Install prometheus-node-exporter package
  become: true
  apt:
    name: prometheus-node-exporter
    state: present

- name: Set node_exporter args for apt package installation
  become: true
  lineinfile:
    path: "/etc/default/prometheus-node-exporter"
    regexp: "^ARGS="
    line: "ARGS='{{ node_exporter_args | join(' ') }} \
      --web.listen-address=:{{ node_exporter_port }}'"
    state: present
    mode: "0644"
  when: not node_exporter_install_from_binary
